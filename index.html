<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Deals of Phone</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet"/>
<style>
:root {
  --brand: #23993F;
  --accent: #FFE82F;
  --background: #f6f8fc;
  --header-radius: 24px;
  --card-radius: 16px;
  --shadow: 0 3px 12px #23993F20;
  --button: #23993F;
  --button-text: #fff;
}
body {
  margin: 0; background: var(--background);
  font-family: 'Inter', Arial, sans-serif;
}
header {
  padding: 1.1rem 0 0.6rem 0;
  background: var(--brand);
  color: #fff;
  font-size: 1.3rem;
  text-align: center;
  font-weight: 700;
  border-bottom-left-radius: var(--header-radius);
  border-bottom-right-radius: var(--header-radius);
  box-shadow: var(--shadow);
}
#promoBanner {
  margin: 0.6rem auto 0.2rem auto;
  max-width: 480px;
  background: var(--accent);
  color: #073b14;
  text-align: center;
  padding: 0.5rem 1.2rem;
  border-radius: 10px;
  font-weight: 600;
  font-size: 1.09rem;
  box-shadow: var(--shadow);
  position: relative;
}
#promoBanner .close {
  position: absolute; right: 12px; top: 7px; font-size: 1.3rem; cursor:pointer; background: none; border:none; color: #23993F;
}
.filters {
  margin: 0.3rem auto 0.2rem auto; max-width: 600px; padding: 10px; background: #e4eced;
  border-radius: 12px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;
}
.filters select, .filters input[type="text"] {
  border-radius: 8px; border: none; padding: 8px 1rem; font-size: .99rem;
  background: #fff; min-width: 110px;
  box-shadow: 0 1px 3px #23993F16;
}
.filters input[type="range"] {width:130px;}
.filters label {font-size:.97rem;}
#product-list {
  max-width: 1200px;
  margin: 1.2rem auto 2rem auto;
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(320px,1fr));
  gap: 22px;
  padding: 0 1rem;
}
.card {
  background: #fff;
  border-radius: var(--card-radius);
  box-shadow: var(--shadow);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  padding-bottom: 0.6rem;
  position: relative;
}
.card .phone-images {
  width: 100%; height: 175px; background: #f3f3f3;
  display:flex; align-items:center; justify-content:center; gap:6px; overflow-x:auto; padding-left: 3px;
}
.card .phone-images img {
  width: 105px; height: 160px; object-fit:cover; border-radius: 12px; margin-top:12px;
  box-shadow: 0 1px 6px #23993F18;
}
.card .info {
  padding: 1rem 1.1rem; flex:1; display:flex; flex-direction:column; font-size:1rem;
}
.card .phone-name {
  font-weight:700; color:var(--brand); font-size:1.17rem;
  margin-bottom: 6px;
}
.card .info-line {color:#285E36; margin-bottom: 3px; font-size:.99rem;}
.card .price {font-weight:700; color:#044f12; font-size:1.13rem; margin:7px 0;}
.card .actions {
  display:flex; gap:8px; flex-wrap:wrap; margin-top:.8rem; justify-content:left; align-items: center;
}
.button {
  border:none; padding:0.45rem 1.15rem; border-radius:8px;
  background: var(--button); color: var(--button-text);
  font-weight:600; font-size:.98rem; cursor:pointer;margin-right:2px;
  box-shadow:0 2px 8px #23993F27;
  transition:background .16s;
}
.button:hover {background:#2fd460;}
.button.fav {background:#fff;color:#e92f2f;border:2px solid var(--accent);}
.button.fav.active {background: var(--accent); color: var(--brand);}
.button.fav:hover {background: var(--accent);}
.popup-bg {
  position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9000;
  background:rgba(40,88,54,.65);display:none;align-items: center; justify-content: center;
}
.popup {
  background: #fff; border-radius:20px; box-shadow:0 6px 30px #23993F40;
  max-width: 92vw; width: 370px; padding:2.2rem 1.1rem 1.7rem 1.1rem;
  text-align: center; position:relative; animation:popupIn .33s;
}
@keyframes popupIn {from{opacity:0;transform:scale(.97);}to{opacity:1;transform:none;}}
.popup .close-btn {position:absolute; top:8px; right:15px; font-size:1.4rem; background: none; border: none; color: #23993F; cursor:pointer;}
.popup .gallery {display:flex; gap:7px; overflow-x:auto; margin:0 auto 1.2rem auto; justify-content:center;}
.popup .gallery img {height:85px; width:60px; object-fit:cover; border-radius:9px;}
.popup h3 {margin-top:0;color:var(--brand);}
.popup .specs {text-align:left; font-size:.99rem; color:#1d392e; margin-bottom:1.1rem;}
.popup .popup-actions {display:flex; gap:0.7rem; flex-wrap:wrap; justify-content:center;}
.popup .popup-actions button {flex-grow:1;}
.admin-bar {
  margin:2rem auto 1rem auto; text-align:center;
  display: flex; gap:8px; justify-content: center; max-width:600px;
}
.hidden {display:none;}
footer {
  text-align:center;padding:1.2rem 0; color:#265a36;font-size:.97rem;
}
footer button {
  background: var(--brand); border-radius: 10px; border: none;
  padding: 0.5rem 1.1rem; color: white; font-weight: 600; font-size: .98rem;
  margin-top: 0.5rem; cursor: pointer; box-shadow: 0 2px 7px #23993F13;
}
@media(max-width:500px){#product-list{grid-template-columns:1fr;gap:13px;}.popup{width:98vw;max-width:none}.card .phone-images img{height:120px;width:75px;}}
.upload-btn {background:var(--accent);color:#1d392e;border-radius:7px;border:none;padding:.45rem 1rem;font-weight:600;font-size:.96rem;cursor:pointer;box-shadow:0 2px 8px #23993F15;}
.upload-btn:active {background:#fff;}
input[type="file"]{display:none;}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
<header>
  Deals of Phone
</header>
<div id="promoBanner">
  <span id="promoBannerText">ðŸ’¥ Trade-in flash sale! Extra â‚¹2000 cashback this week.</span>
  <button class="close" aria-label="Close" onclick="document.getElementById('promoBanner').style.display='none'">&times;</button>
</div>
<div class="filters">
  <input type="text" id="search" placeholder="Search Phones..." autocomplete="off" />
  <select id="filterBrand"><option value="">Brand</option><option>Samsung</option><option>Apple</option><option>Xiaomi</option></select>
  <select id="filterRam"><option value="">RAM</option><option>4GB</option><option>6GB</option><option>8GB</option></select>
  <select id="filterStorage"><option value="">Storage</option><option>64GB</option><option>128GB</option></select>
  <select id="filterNetwork"><option value="">4G/5G</option><option>4G</option><option>5G</option></select>
  <label id="priceLabel">Max Price: â‚¹100000</label>
  <input type="range" id="filterPrice" min="5000" max="100000" value="100000" step="1000" />
</div>
<main id="product-list"></main>
<div class="admin-bar hidden" id="adminBar">
  <button id="btnShowAdminPanel">Panel</button>
  <button id="btnExport">Export</button>
  <button id="btnImport">Import</button>
  <button id="btnLogout">Logout</button>
</div>
<div class="popup-bg" id="popup-bg">
  <div class="popup" id="popup">
    <button class="close-btn" aria-label="Close popup" onclick="hidePopup()">&times;</button>
    <div id="popup-content"></div>
  </div>
</div>
<footer>
  <button id="btnAdminLogin">Admin Login</button>
  <span id="pwaStatus" aria-live="polite"></span>
</footer>
<script>
const adminUser = "dealadmin";
const adminPass = "phone@2025";
const whatsappNumber = "917019535988";
const STORAGE_PRODUCTS_KEY = "dealsOfPhoneProducts";
const STORAGE_FAVS_KEY = "dealsOfPhoneFavorites";
// In-memory state for images
let products = [], favorites = new Set(), isAdmin = false;

function saveProducts() {
  localStorage.setItem(STORAGE_PRODUCTS_KEY, JSON.stringify(products));
}
function loadProducts() {
  const raw = localStorage.getItem(STORAGE_PRODUCTS_KEY);
  if (!raw) return null;
  try { return JSON.parse(raw); } catch { return null; }
}
function saveFavorites() {
  localStorage.setItem(STORAGE_FAVS_KEY, JSON.stringify([...favorites]));
}
function loadFavorites() {
  const raw = localStorage.getItem(STORAGE_FAVS_KEY);
  if (!raw) return new Set();
  try { return new Set(JSON.parse(raw)); } catch { return new Set(); }
}
function initializeDefaultProducts() {
  if (!loadProducts()) {
    products = [
      {
        id: "prd001",
        name: "Samsung Galaxy S21",
        brand: "Samsung",
        ram: "8GB",
        storage: "128GB",
        condition: "Like New",
        price: 22000,
        images: [],
        imei: "356478903465789",
        network: "5G"
      },
      {
        id: "prd002",
        name: "Apple iPhone 12",
        brand: "Apple",
        ram: "4GB",
        storage: "64GB",
        condition: "Excellent",
        price: 32000,
        images: [],
        imei: "352099763747654",
        network: "5G"
      },
      {
        id: "prd003",
        name: "Xiaomi Redmi Note 9",
        brand: "Xiaomi",
        ram: "6GB",
        storage: "128GB",
        condition: "Very Good",
        price: 15000,
        images: [],
        imei: "865309997475003",
        network: "4G"
      }
    ];
    saveProducts();
  } else {
    products = loadProducts();
  }
}
function createProductCard(product) {
  const card = document.createElement("article");
  card.className = "card";
  // Prefer uploaded image or placeholder
  let imgs = (product.images && product.images.length) ? product.images : ["https://i.imgur.com/zVxbIWY.png"];
  card.innerHTML = `
    <div class="phone-images">${imgs.map(img => `<img src="${img}" alt="${product.name}" loading="lazy" />`).join("")}</div>
    <div class="info">
      <div class="phone-name">${product.name}</div>
      <div class="info-line">${product.brand} â€¢ ${product.condition}</div>
      <div class="info-line">RAM: ${product.ram} | Storage: ${product.storage} | ${product.network}</div>
      <div class="info-line" style="opacity:.8">IMEI: <code>${product.imei}</code></div>
      <div class="price">â‚¹${product.price}</div>
      <div class="actions">
        <button class="button" onclick="showProductPopup('${product.id}')">Details</button>
        <button class="button" onclick="showQRCode('${product.id}')">QR</button>
        <button class="button" onclick="orderWhatsApp('${product.id}')">WhatsApp</button>
        <button class="button fav${favorites.has(product.id)?' active':''}" onclick="toggleFavorite('${product.id}')">&#10084;</button>
      </div>
    </div>
  `;
  return card;
}
function filterProducts() {
  const searchTerm = document.getElementById("search").value.trim().toLowerCase();
  const brand = document.getElementById("filterBrand").value;
  const ram = document.getElementById("filterRam").value;
  const storage = document.getElementById("filterStorage").value;
  const network = document.getElementById("filterNetwork").value;
  const maxPrice = Number(document.getElementById("filterPrice").value);
  document.getElementById("priceLabel").textContent = `Max Price: â‚¹${maxPrice}`;
  return products.filter(p => (
    (p.name.toLowerCase().includes(searchTerm) || p.brand.toLowerCase().includes(searchTerm)) &&
    (brand==="" || p.brand===brand) && (ram==="" || p.ram===ram) &&
    (storage==="" || p.storage===storage) && (network==="" || p.network===network) &&
    (p.price <= maxPrice)
  ));
}
function renderProducts() {
  const productListEl = document.getElementById("product-list");
  productListEl.innerHTML = "";
  const filtered = filterProducts();
  if (!filtered.length) {
    productListEl.innerHTML = "<div style='text-align:center; color:#666;'>No products found.</div>";
    return;
  }
  filtered.forEach(prod => productListEl.appendChild(createProductCard(prod)));
}
function showProductPopup(id) {
  const prod = products.find(p => p.id === id);
  if (!prod) return;
  let imgs = prod.images && prod.images.length ? prod.images : ["https://i.imgur.com/zVxbIWY.png"];
  document.getElementById("popup-content").innerHTML = `
    <div class="gallery">${imgs.map(img => `<img src="${img}" alt="${prod.name}" loading="lazy"/>`).join("")}</div>
    <h3>${prod.name}</h3>
    <div class="specs">
      <strong>Brand:</strong> ${prod.brand}<br/>
      <strong>Condition:</strong> ${prod.condition}<br/>
      <strong>IMEI:</strong> <code>${prod.imei}</code><br/>
      <strong>Price:</strong> â‚¹${prod.price}<br/>
      <strong>RAM / Storage:</strong> ${prod.ram} / ${prod.storage}<br/>
      <strong>Network:</strong> ${prod.network}
    </div>
    <div class="popup-actions">
      <button class="button" onclick="orderWhatsApp('${id}')">WhatsApp</button>
      <button class="button" onclick="showQRCode('${id}')">QR</button>
      <button class="button fav${favorites.has(prod.id)?' active':''}" onclick="toggleFavorite('${prod.id}')">&#10084;</button>
    </div>
  `;
  document.getElementById("popup-bg").style.display = "flex";
}
function hidePopup() {
  document.getElementById("popup-bg").style.display = "none";
}
function showQRCode(id) {
  const prod = products.find(p => p.id === id);
  if (!prod) return;
  const qrText = `${window.location.origin}${window.location.pathname}#product=${prod.id}`;
  document.getElementById("popup-content").innerHTML = `
    <div style="margin-bottom: 1rem; text-align:center;">
      <strong>Scan QR for this phone</strong>
    </div>
    <div id="qrcode"></div>
    <div style="margin-top: 1rem; text-align:center;">
      <button class="button" onclick="navigator.clipboard.writeText('${qrText}').then(()=>alert('Link copied!'))">Copy Link</button>
    </div>
  `;
  document.getElementById("popup-bg").style.display = "flex";
  setTimeout(() => new QRCode(document.getElementById("qrcode"), {
    text: qrText,
    width: 160,
    height: 160,
    colorDark: "#23993F",
    colorLight: "#fff"
  }), 100);
}
function orderWhatsApp(id) {
  const prod = products.find(p => p.id === id);
  if (!prod) return;
  const name = prompt("Your Name:");
  if (!name) { alert("Enter your name."); return; }
  const phone = prompt("Your Phone Number:");
  if (!phone) { alert("Enter your phone number."); return; }
  const msg = `Order:\nName: ${name}\nPhone: ${phone}\nProduct: ${prod.name}\nIMEI: ${prod.imei}\nPrice: â‚¹${prod.price}`;
  window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(msg)}`,"_blank");
}
function toggleFavorite(id) {
  if (favorites.has(id)) favorites.delete(id);
  else favorites.add(id);
  saveFavorites();
  renderProducts();
}
function showAdminPanel() {
  if (!isAdmin) return;
  const el = document.getElementById("popup-content");
  let panel = `
    <h2>Admin Panel</h2>
    <table style="width:98%;margin:auto;background:#fff;border-radius: 12px;box-shadow:0 2px 10px #23993F18;">
      <tr style="background:#eaeaea;font-size:.98rem;">
        <th>Name</th><th>Brand</th><th>RAM</th><th>Storage</th><th>Condition</th>
        <th>Price</th><th>IMEI</th><th>Network</th><th>Photos</th><th>Act</th>
      </tr>
      ${products.map(prod => `
      <tr>
        <td><input value="${prod.name}" onchange="adminEdit('${prod.id}',this.value,'name')" style="width:70px"></td>
        <td><input value="${prod.brand}" onchange="adminEdit('${prod.id}',this.value,'brand')" style="width:60px"></td>
        <td><input value="${prod.ram}" onchange="adminEdit('${prod.id}',this.value,'ram')" style="width:60px"></td>
        <td><input value="${prod.storage}" onchange="adminEdit('${prod.id}',this.value,'storage')" style="width:70px"></td>
        <td><input value="${prod.condition}" onchange="adminEdit('${prod.id}',this.value,'condition')" style="width:75px"></td>
        <td><input type="number" value="${prod.price}" onchange="adminEdit('${prod.id}',this.value,'price')" style="width:65px"></td>
        <td><input value="${prod.imei}" onchange="adminEdit('${prod.id}',this.value,'imei')" style="width:120px"></td>
        <td><input value="${prod.network}" onchange="adminEdit('${prod.id}',this.value,'network')" style="width:60px"></td>
        <td>
          <label for="imgup_${prod.id}" class="upload-btn">Add</label>
          <input id="imgup_${prod.id}" type="file" multiple accept="image/*" onchange="uploadImages(this.files,'${prod.id}')"/>
          <div style="display:flex;gap:2px;flex-wrap:wrap;">
            ${(prod.images||[]).map((img,i)=> `<img src="${img}" width="30" height="38" style="object-fit:cover;border-radius:5px;margin-top:4px;border:1px solid #eee"/> <button style="font-size:.89rem;" onclick="removeImage('${prod.id}',${i})">&times;</button>`).join("")}
          </div>
        </td>
        <td><button onclick="adminDelete('${prod.id}')">Delete</button></td>
      </tr>`).join('')}
    </table>
    <h3>Add Phone</h3>
    <div style="display:flex;flex-wrap:wrap;gap:8px;justify-content:left;">
      <input id="newName" placeholder="Name"/>
      <input id="newBrand" placeholder="Brand"/>
      <input id="newRam" placeholder="RAM"/>
      <input id="newStorage" placeholder="Storage"/>
      <input id="newCondition" placeholder="Condition"/>
      <input id="newPrice" type="number" placeholder="Price"/>
      <input id="newIMEI" placeholder="IMEI"/>
      <input id="newNetwork" placeholder="Network"/>
      <label for="newImages" class="upload-btn">Add Photo</label>
      <input id="newImages" type="file" multiple accept="image/*"/>
    </div>
    <button class="button" style="margin-top:7px;" onclick="adminAdd()">Add</button>
    <h3>Promo Banner</h3>
      <input id="bannerInput" placeholder="Promo Banner Text" style="width:96%;border-radius:8px;margin-bottom:7px;font-size:.96rem;"/>
      <button class="button" onclick="document.getElementById('promoBannerText').innerText=document.getElementById('bannerInput').value">Update Banner</button>
  `;
  el.innerHTML = panel;
  document.getElementById("popup-bg").style.display = "flex";
  document.getElementById("newImages").onchange = function(){window._newImages=this.files;};
}
function adminEdit(id,val,field){
  let prod = products.find(p=>p.id===id);
  prod[field]=field=="price"?Number(val):val;
  saveProducts(); renderProducts(); showAdminPanel();
}
function adminDelete(id){
  products = products.filter(p=>p.id!==id);
  saveProducts(); renderProducts(); showAdminPanel();
}
function adminAdd(){
  let n = document.getElementById("newName").value.trim(),
      b = document.getElementById("newBrand").value.trim(),
      r = document.getElementById("newRam").value.trim(),
      s = document.getElementById("newStorage").value.trim(),
      c = document.getElementById("newCondition").value.trim(),
      p = Number(document.getElementById("newPrice").value),
      i = document.getElementById("newIMEI").value.trim(),
      nw = document.getElementById("newNetwork").value.trim();
  if(!n) return alert("Enter phone name");
  let prod = {id:"prd"+Date.now(),name:n,brand:b,ram:r,storage:s,condition:c,price:p,imei:i,network:nw,images:[]};
  if(window._newImages && window._newImages.length){
    let imgs = [];
    let readerCount = 0;
    for(let f of window._newImages){
      let reader = new FileReader();
      reader.onload = e=>{imgs.push(e.target.result);readerCount++;if(readerCount===window._newImages.length){prod.images=imgs;products.push(prod);saveProducts();renderProducts();showAdminPanel();window._newImages=null;}};
      reader.readAsDataURL(f);
    }
  }else{
    products.push(prod); saveProducts(); renderProducts(); showAdminPanel();
  }
}
function uploadImages(files,id){
  let prod = products.find(p=>p.id===id); if(!prod) return;
  let readers = [], imgs = [];
  for(let f of files){
    let reader = new FileReader();
    reader.onload = e=>{
      imgs.push(e.target.result);
      if(imgs.length===files.length){
        prod.images=(prod.images||[]).concat(imgs);
        saveProducts(); renderProducts(); showAdminPanel();
      }
    };
    reader.readAsDataURL(f);
  }
}
function removeImage(id,idx){
  let prod = products.find(p=>p.id===id); if(!prod) return;
  prod.images.splice(idx,1); saveProducts(); renderProducts(); showAdminPanel();
}
function showAdminPanelIfAdmin() {
  if (isAdmin) showAdminPanel();
}
document.getElementById("btnAdminLogin").onclick = ()=>{
  if(isAdmin){
    if(confirm("Logout admin?")){ isAdmin = false; document.getElementById("adminBar").classList.add("hidden"); alert("Admin logged out."); hidePopup(); }
    return;
  }
  if(prompt("Enter admin username:")!==adminUser){alert("Invalid username.");return;}
  if(prompt("Enter admin password:")!==adminPass){alert("Invalid password.");return;}
  isAdmin = true;
  document.getElementById("adminBar").classList.remove("hidden");
  showAdminPanel();
};
document.getElementById("btnShowAdminPanel").onclick = showAdminPanel;
document.getElementById("btnExport").onclick = ()=>{
  let blob = new Blob([JSON.stringify(products,null,2)],{type:"application/json"});
  let url = URL.createObjectURL(blob);
  let a = document.createElement("a"); a.href=url;a.download="deals_of_phone_products_"+Date.now()+".json";a.click();
  URL.revokeObjectURL(url);
};
document.getElementById("btnImport").onclick = ()=>{
  let input = document.createElement("input"); input.type="file"; input.accept="application/json";
  input.onchange = e=>{
    let file = e.target.files[0];
    if(!file) return;
    let reader = new FileReader();
    reader.onload = evt => {
      try{
        let imported = JSON.parse(evt.target.result);
        if(Array.isArray(imported)){ products=imported; saveProducts(); renderProducts(); showAdminPanel();}
        else alert("Invalid structure");
      }catch{alert("Parse error");}
    };
    reader.readAsText(file);
  }; input.click();
};
document.getElementById("btnLogout").onclick = ()=>{
  if(confirm("Logout admin?")){isAdmin=false;document.getElementById("adminBar").classList.add("hidden");hidePopup();}
};
document.getElementById("filterPrice").addEventListener("input",()=>{document.getElementById("priceLabel").textContent=`Max Price: â‚¹${document.getElementById("filterPrice").value}`;renderProducts();});
["search","filterBrand","filterRam","filterStorage","filterNetwork"].forEach(id=>document.getElementById(id).addEventListener("input",renderProducts));
window.hidePopup = hidePopup;
function toggleFavorite(id) {
  if (favorites.has(id)) favorites.delete(id);
  else favorites.add(id);
  saveFavorites();
  renderProducts();
}
function init() {
  initializeDefaultProducts();
  favorites = loadFavorites();
  renderProducts();
  // hash product detail deep-link
  const hash = window.location.hash;
  if(hash && hash.startsWith("#product=")){
    const pid = hash.split("=")[1];
    setTimeout(()=>showProductPopup(pid),600);
  }
}
init();
</script>
</body>
</html>
